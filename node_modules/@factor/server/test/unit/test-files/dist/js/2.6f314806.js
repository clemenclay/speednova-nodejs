(window.webpackJsonp=window.webpackJsonp||[]).push([[2],{410:function(t,e,s){"use strict";s.r(e);var a=s(1),i=s(2),n=s(67),o=i.a.extend({name:"Site",mixins:Object(a.e)("site-mixins",[i.a.extend({data:()=>({scrollClass:""}),computed:{post:()=>Object(a.A)("post"),ui(){const{meta:t={}}=this.$route.matched.find(t=>t.meta.ui)||{};return`factor-${t.ui||"app"}`},classes(){const t=Object(n.b)();return[Object(a.e)("observable-class-keys",[]).map(e=>t[e]).filter(t=>t&&Array.isArray(t)).map(t=>t.join(" ")).join(" "),this.scrollClass]},injectedComponents:()=>Object(a.e)("site-components",[]).map(t=>t.component)},watch:{ui:{handler:function(t,e){if("undefined"!=typeof document){const s=document.documentElement;s.classList.remove(e),s.classList.add(t)}}}},mounted(){this.setScrollClass(),window.addEventListener("scroll",()=>this.setScrollClass())},async serverPrefetch(){return await Object(a.t)("global-prefetch",this.$route)},methods:{setScrollClass(){this.scrollClass=0==window.pageYOffset?"top":"scrolled"}}})])}),r=(s(474),s(414)),l=Object(r.a)(o,(function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"factor-site",class:this.classes,attrs:{id:"app"}},[e("router-view"),this._v(" "),this._l(this.injectedComponents,(function(t,s){return e(t,{key:s,tag:"component"})}))],2)}),[],!1,null,null,null);e.default=l.exports},411:function(t,e,s){"use strict";s.r(e);var a=s(2).a.extend({}),i=s(414),n=Object(i.a)(a,(function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"content-layout"},[e("router-view")],1)}),[],!1,null,null,null);e.default=n.exports},412:function(t,e,s){"use strict";s.r(e);var a=s(423).a,i=(s(473),s(414)),n=Object(i.a)(a,(function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"fallback-page"},[e("div",{staticClass:"fallback-page-pad"},[e("div",{staticClass:"title"},[this._v(this._s(this.title))]),this._v(" "),e("div",{staticClass:"sub-title"},[this._v(this._s(this.subTitle))])])])}),[],!1,null,null,null);e.default=n.exports},414:function(t,e,s){"use strict";function a(t,e,s,a,i,n,o,r){var l,d="function"==typeof t?t.options:t;if(e&&(d.render=e,d.staticRenderFns=s,d._compiled=!0),a&&(d.functional=!0),n&&(d._scopeId="data-v-"+n),o?(l=function(t){(t=t||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext)||"undefined"==typeof __VUE_SSR_CONTEXT__||(t=__VUE_SSR_CONTEXT__),i&&i.call(this,t),t&&t._registeredComponents&&t._registeredComponents.add(o)},d._ssrRegister=l):i&&(l=r?function(){i.call(this,this.$root.$options.shadowRoot)}:i),l)if(d.functional){d._injectStyles=l;var u=d.render;d.render=function(t,e){return l.call(e),u(t,e)}}else{var c=d.beforeCreate;d.beforeCreate=c?[].concat(c,l):[l]}return{exports:t,options:d}}s.d(e,"a",(function(){return a}))},415:function(t,e,s){"use strict";s.d(e,"u",(function(){return o})),s.d(e,"b",(function(){return r})),s.d(e,"c",(function(){return l})),s.d(e,"v",(function(){return d})),s.d(e,"w",(function(){return u})),s.d(e,"d",(function(){return c})),s.d(e,"a",(function(){return p})),s.d(e,"t",(function(){return h})),s.d(e,"s",(function(){return m})),s.d(e,"i",(function(){return f})),s.d(e,"p",(function(){return b})),s.d(e,"h",(function(){return g})),s.d(e,"g",(function(){return v})),s.d(e,"k",(function(){return y})),s.d(e,"q",(function(){return _})),s.d(e,"r",(function(){return x})),s.d(e,"l",(function(){return I})),s.d(e,"f",(function(){return j})),s.d(e,"n",(function(){return O})),s.d(e,"e",(function(){return w})),s.d(e,"j",(function(){return $})),s.d(e,"m",(function(){return C})),s.d(e,"o",(function(){return k}));var a=s(9),i=s(1);const n="formattedText";Object(i.c)({key:n,hook:"client-directives",callback:t=>(t["formatted-text"]=function(t,e){t.innerHTML=Object(i.u)(e.value)},t)}),Object(i.c)({key:n,hook:"server-directives",callback:t=>(t["formatted-text"]=function(t,e){if(!t.data)return;const s=Object(i.u)(e.value);(t.data.domProps||(t.data.domProps={})).innerHTML=s},t)});Object(a.a)("app.components.error404"),Object(a.a)("app.components.content"),Object(a.a)("app.components.site");const o=Object(a.a)("core.components.link"),r=Object(a.a)("core.components.btn"),l=(Object(a.a)("core.components.btnBase"),Object(a.a)("core.components.btnDashboard")),d=(Object(a.a)("core.components.modalApp"),Object(a.a)("core.components.modal"),Object(a.a)("core.components.loadingRing")),u=()=>Promise.all([s.e(3),s.e(1)]).then(s.bind(null,549)),c=()=>s.e(0).then(s.bind(null,550)),p=()=>s.e(1).then(s.bind(null,551)),h=Object(a.a)("core.components.lightbox"),m=()=>s.e(0).then(s.bind(null,553)),f=()=>s.e(0).then(s.bind(null,554)),b=()=>s.e(0).then(s.bind(null,555)),g=()=>Promise.all([s.e(1),s.e(2)]).then(s.bind(null,556)),v=()=>s.e(1).then(s.bind(null,557)),y=()=>s.e(0).then(s.bind(null,558)),_=()=>s.e(0).then(s.bind(null,559)),x=()=>Promise.all([s.e(3),s.e(0)]).then(s.bind(null,560)),I=()=>s.e(1).then(s.bind(null,561)),j=()=>s.e(0).then(s.bind(null,562)),O=()=>Promise.all([s.e(3),s.e(4),s.e(1)]).then(s.bind(null,563)),w=()=>Promise.all([s.e(3),s.e(1)]).then(s.bind(null,544)),$=()=>Promise.all([s.e(3),s.e(4),s.e(1),s.e(2)]).then(s.bind(null,564)),C=()=>s.e(1).then(s.bind(null,565)),k=()=>s.e(1).then(s.bind(null,566))},418:function(t,e,s){"use strict";s.d(e,"e",(function(){return o})),s.d(e,"d",(function(){return r})),s.d(e,"c",(function(){return l})),s.d(e,"b",(function(){return d})),s.d(e,"f",(function(){return u})),s.d(e,"a",(function(){return c})),s.d(e,"g",(function(){return p})),s.d(e,"h",(function(){return h})),s.d(e,"i",(function(){return f}));var a=s(1),i=s(9),n=s(52);const o=()=>s.e(0).then(s.bind(null,531)),r=()=>s.e(1).then(s.bind(null,532)),l=()=>s.e(1).then(s.bind(null,533)),d=()=>s.e(1).then(s.bind(null,534)),u=()=>s.e(0).then(s.bind(null,536)),c=()=>s.e(0).then(s.bind(null,537)),p=()=>s.e(0).then(s.bind(null,538)),h=()=>s.e(0).then(s.bind(null,539)),m=()=>{const t=Object(i.a)("dashboard.route");if(!t)throw new Error("Dashboard settings are missing. There may be a problem with settings generation; check the files in your '.factor' folder.");return t},f=(t,e)=>{if(t&&t.startsWith("/"))return t;return`${e||m()}/${t||""}`};Object(a.c)({key:"dashboard",hook:"routes",callback:t=>{const e=m(),i=f("account");return t.push({path:"/admin",redirect:i}),t.push({path:e,redirect:i}),t.push({path:e,component:()=>s.e(0).then(s.bind(null,540)),children:Object(a.e)("dashboard-routes",[{path:"*",component:()=>s.e(1).then(s.bind(null,541)),meta:{auth:!0},priority:3e3}]),meta:{auth:!0,format:"dashboard",ui:"dashboard"}}),t}}),Object(a.c)({key:"dashboard",hook:"admin-menu",callback:t=>(Object(a.r)().filter(({hideAdmin:t,accessLevel:e})=>!(t||e&&!Object(n.d)({accessLevel:e}))).forEach(({postType:e,namePlural:s,icon:i="",noAddNew:n=!1,addNewText:o="Add New"})=>{var r;const l=[];!n&&o&&l.push({path:null!==(r=Object(a.x)(o))&&void 0!==r?r:"",name:o}),l.push({path:"edit"}),t.push({group:e,path:`posts/${e}`,name:s||Object(a.E)(e),icon:i,items:Object(a.e)(`admin-menu-post-${e}`,l)})}),t)})},423:function(t,e,s){"use strict";(function(t){var a=s(2);e.a=a.a.extend({metaInfo(){return{title:`${this.errorText} Error`,description:`Looks like you've hit a ${this.errorText} error.`,meta:[{name:"robots",content:"noindex"}]}},computed:{errorText(){return this.$route.meta.error||404},title(){return this.details.title},subTitle(){return this.details.subTitle},details(){let t;return t=403==this.$route.meta.error?{title:"403 Error",subTitle:"You don't have permissions to access this page"}:{title:"404 Error",subTitle:"This page doesn't exist."},t}},created(){t&&(t.env.factorServerStatus="404")}})}).call(this,s(10))},424:function(t,e,s){},425:function(t,e,s){},426:function(t,e,s){},427:function(t,e,s){},428:function(t,e,s){},446:function(t,e,s){},451:function(t,e,s){},472:function(t,e,s){"use strict";s.d(e,"a",(function(){return l})),s.d(e,"b",(function(){return u}));var a=s(41),i=s(1),n=s(496),o=s.n(n);var r=s(501);Object(i.d)(r.a);const l=async t=>await(async({method:t,params:e})=>await Object(a.b)({id:"storage",method:t,params:e}))({method:"deleteImage",params:t}),d=async({file:t,onPrep:e},s={})=>(e&&e({mode:"started",percent:5}),t.type.includes("image")&&(t=await(async(t,{maxWidth:e=1200,maxHeight:s=1200})=>await new Promise(a=>{o()(t,e=>{e.toBlob(t=>{t&&a(t)},t.type)},{maxWidth:e,maxHeight:s,canvas:!0,orientation:!0})}))(t,s),e&&e({mode:"resized",percent:25,preview:URL.createObjectURL(t)})),e&&e({mode:"finished",percent:100}),t),u=async({file:t,onPrep:e,onFinished:s,onError:n,onChange:o})=>{t=await d({file:t,onPrep:e});const r=new FormData;r.append("imageUpload",t);const{data:{result:l,error:u}}=await Object(a.a)("/_upload",r,{headers:{"Content-Type":"multipart/form-data"},onUploadProgress:function(t){o&&o(t)}});u&&n?n(u):(Object(i.z)(l._id,l),s&&s(l))}},473:function(t,e,s){"use strict";var a=s(424);s.n(a).a},474:function(t,e,s){"use strict";var a=s(425);s.n(a).a},475:function(t,e,s){t.exports=s.p+"test-image-71ebea5d.jpg"},476:function(t,e,s){"use strict";var a=s(426);s.n(a).a},477:function(t,e,s){"use strict";var a=s(427);s.n(a).a},478:function(t,e,s){"use strict";var a=s(428);s.n(a).a},501:function(t,e,s){"use strict";(function(t){e.a={name:"attachment",schema:{mimetype:String,imageData:t,size:Number,url:String},permissions:{create:{accessLevel:1},retrieve:{accessLevel:0}}}}).call(this,s(5).Buffer)},502:function(t,e,s){"use strict";var a=s(446);s.n(a).a},507:function(t,e,s){"use strict";var a=s(451);s.n(a).a},545:function(t,e,s){"use strict";s.r(e);var a=s(2).a.extend({data:()=>({msg:"::hello::",img:s(475)})}),i=(s(476),s(414)),n=Object(i.a)(a,(function(){var t=this.$createElement,e=this._self._c||t;return e("div",[e("span",{staticClass:"message"},[this._v(this._s(this.msg))]),this._v(" "),e("img",{attrs:{src:this.img}})])}),[],!1,null,null,null);e.default=n.exports},546:function(t,e,s){"use strict";s.r(e);var a=s(52),i=s(1),n=s(23),o=s(2).a.extend({components:{"edit-user":()=>s.e(2).then(s.bind(null,548))},computed:{post:()=>Object(i.A)(Object(a.e)())||{}},async mounted(){const t=await Object(a.f)();t&&t._id&&await Object(n.f)({_id:t._id,postType:"user"})}}),r=s(414),l=Object(r.a)(o,(function(){var t=this.$createElement;return(this._self._c||t)("edit-user",{attrs:{post:this.post}})}),[],!1,null,null,null);e.default=l.exports},547:function(t,e,s){"use strict";s.r(e);var a=s(418),i=s(52),n=s(40),o=s(1),r=s(23),l=s(2).a.extend({name:"UserList",components:{dashboardPane:a.e,dashboardTableFooter:a.f,dashboardListPost:a.c,dashboardListControls:a.b},props:{title:{type:String,default:""},list:{type:Array,default:()=>[]},meta:{type:Object,default:()=>{}},loading:{type:Boolean,default:!1}},data:()=>({selected:[],loadingAction:!1}),computed:{currentUser:i.a,roles:()=>["admin","moderator","editor","member"]},methods:{toLabel:o.E,standardDate:o.y,controlStatus(){var t;const e={};return["admin","moderator","editor","member"].forEach(t=>{e[t]=Object(n.c)({meta:this.meta,field:"role",key:t})}),[{value:"",label:`All (${null!==(t=this.meta.totalForQuery)&&void 0!==t?t:0})`},{value:"admin",label:`Admin (${e.admin})`},{value:"moderator",label:`Moderator (${e.moderator})`},{value:"editor",label:`Editor (${e.editor})`},{value:"member",label:`Member (${e.member})`}]},controlActions(){const t=[];return Object(i.d)({accessLevel:400})&&(t.push({value:"delete",label:"Permanently Delete",confirm:t=>`Permanently delete ${t.length} user(s)?`}),this.roles.forEach(e=>{t.push({value:e,label:`Change to ${Object(o.E)(e)}`,confirm:t=>`Change ${t.length} user(s) to "${e}" role?`})})),t},postItemMeta:t=>[{value:Object(o.E)(t.role||"no role")},{label:"Username",value:t.username||t.email},{label:"Since",value:Object(o.y)(t.createdAt)}],async handleAction(t){this.loadingAction=!0,"delete"==t?await Object(r.a)({_ids:this.selected,postType:this.postType}):["admin","moderator","editor","member"].includes(t)&&await Object(r.e)({_ids:this.selected,data:{role:t},postType:"user"}),Object(o.h)("refresh-table"),this.selected=[],this.loadingAction=!1},selectAll(t){this.selected=t?this.list.map(t=>t._id):[]}}}),d=(s(477),s(414)),u=Object(d.a)(l,(function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("dashboard-pane",{attrs:{title:t.title}},[s("dashboard-list-controls",{attrs:{"control-actions":t.controlActions(),"control-status":t.controlStatus(),"status-field":"role",selected:t.selected,loading:t.loading,list:t.list},on:{action:function(e){return t.handleAction(e)},"select-all":function(e){return t.selectAll(e)}}}),t._v(" "),t._l(t.list,(function(e){return s("dashboard-list-post",{key:e._id,attrs:{post:e,title:e.displayName||"No Name","sub-title":e.email,meta:t.postItemMeta(e)},model:{value:t.selected,callback:function(e){t.selected=e},expression:"selected"}})})),t._v(" "),s("dashboard-table-footer",t._b({attrs:{meta:t.meta}},"dashboard-table-footer",t.$attrs,!1))],2)}),[],!1,null,null,null);e.default=u.exports},548:function(t,e,s){"use strict";s.r(e);var a=s(418),i=s(415),n=s(52),o=s(93),r=s(1),l=s(23),d=s(2).a.extend({components:{dashboardPage:a.d,dashboardPane:a.e,dashboardInput:a.a,factorBtnDashboard:i.c},data:()=>({sending:!1,loading:!1,postType:"user"}),computed:{post:{get(){return Object(r.A)(this._id)||{}},set(t){Object(r.z)(this._id,t)}},profile(){return this.post.profile||{}},_id(){return this.$route.query._id||Object(n.e)()},url(){return this.post.username?`/@${this.post.username}`:`/@?_id=${this.post._id}`}},methods:{userId:n.e,standardDate:r.y,async sendVerifyEmail(){this.sending=!0,await Object(o.a)({email:this.post.email,_id:this.post._id}),this.sending=!1},async save(){this.sending=!0;try{const t=await Object(l.d)({post:this.post,postType:this.postType});t&&(this.post=t,Object(r.h)("notify","Saved!"))}catch(t){throw this.sending=!1,t}this.sending=!1}}}),u=(s(478),s(414)),c=Object(u.a)(d,(function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("dashboard-page",{attrs:{title:t._id==t.userId()?"Your Account":"Edit User"},scopedSlots:t._u([{key:"actions",fn:function(){return[s("factor-btn-dashboard",{attrs:{btn:"primary",loading:t.sending},on:{click:function(e){return t.save()}}},[t._v("Update")])]},proxy:!0},{key:"meta",fn:function(){return[s("dashboard-pane",{staticClass:"compose inputs",attrs:{title:"Images"}},[s("dashboard-input",{attrs:{max:"1",input:"factor-input-image-upload",label:"Avatar",loading:t.loading},on:{autosave:function(e){return t.$emit("autosave")}},model:{value:t.post.avatar,callback:function(e){t.$set(t.post,"avatar",e)},expression:"post.avatar"}}),t._v(" "),s("dashboard-input",{attrs:{max:"5",min:"1",input:"factor-input-image-upload",label:"Profile Photo(s)",loading:t.loading},on:{autosave:function(e){return t.$emit("autosave")}},model:{value:t.post.images,callback:function(e){t.$set(t.post,"images",e)},expression:"post.images"}}),t._v(" "),s("dashboard-input",{attrs:{max:"5",min:"1",input:"factor-input-image-upload",label:"Cover Photo(s)",loading:t.loading},on:{autosave:function(e){return t.$emit("autosave")}},model:{value:t.post.covers,callback:function(e){t.$set(t.post,"covers",e)},expression:"post.covers"}})],1)]},proxy:!0},{key:"primary",fn:function(){return[s("dashboard-pane",{staticClass:"compose inputs",attrs:{title:"Account Info"}},[s("dashboard-input",{staticClass:"post-title",attrs:{input:"factor-input-text",label:"Display Name"},model:{value:t.post.displayName,callback:function(e){t.$set(t.post,"displayName",e)},expression:"post.displayName"}}),t._v(" "),s("dashboard-input",{staticClass:"email-inputs",attrs:{input:"factor-input-email",label:"Email Address"},model:{value:t.post.email,callback:function(e){t.$set(t.post,"email",e)},expression:"post.email"}},[t.post.email&&!t.post.emailVerified?s("div",{staticClass:"verify-email"},[s("factor-btn-dashboard",{attrs:{size:"small",btn:"primary",loading:t.sending},on:{click:function(e){return t.sendVerifyEmail()}}},[t._v("Unverified - Resend Email â†’")])],1):t._e()]),t._v(" "),s("dashboard-input",{attrs:{input:"factor-input-text",label:"Username",description:"Must be unique."},model:{value:t.post.username,callback:function(e){t.$set(t.post,"username",e)},expression:"post.username"}}),t._v(" "),s("dashboard-input",{attrs:{input:"factor-input-password",label:"Update Password",autocomplete:"new-password"},model:{value:t.post.password,callback:function(e){t.$set(t.post,"password",e)},expression:"post.password"}})],1)]},proxy:!0},{key:"secondary",fn:function(){return[s("dashboard-pane",{staticClass:"inputs",attrs:{title:"Profile"}},[s("dashboard-input",{attrs:{input:"factor-input-textarea",label:"About You"},model:{value:t.post.about,callback:function(e){t.$set(t.post,"about",e)},expression:"post.about"}}),t._v(" "),s("dashboard-input",{attrs:{input:"factor-input-birthday",label:"Birthday",description:"This information is not shared."},model:{value:t.post.birthday,callback:function(e){t.$set(t.post,"birthday",e)},expression:"post.birthday"}}),t._v(" "),s("dashboard-input",{attrs:{list:["female","male"],input:"factor-input-select",label:"Gender",description:"This information is not shared."},model:{value:t.post.gender,callback:function(e){t.$set(t.post,"gender",e)},expression:"post.gender"}}),t._v(" "),s("div",{staticClass:"user-info"},[s("div",{staticClass:"item"},[s("div",{staticClass:"label"},[t._v("Logged In")]),t._v(" "),s("div",{staticClass:"value"},[t._v(t._s(t.standardDate(t.post.signedInAt)))])]),t._v(" "),s("div",{staticClass:"item"},[s("div",{staticClass:"label"},[t._v("Signed up")]),t._v(" "),s("div",{staticClass:"value"},[t._v(t._s(t.standardDate(t.post.createdAt)))])])])],1)]},proxy:!0}])})}),[],!1,null,null,null);e.default=c.exports},556:function(t,e,s){"use strict";s.r(e);var a=s(415),i=s(1),n=s(8),o=s(472),r=s(2).a.extend({components:{factorLoadingRing:a.v},props:{value:{type:String,default:""},postId:{type:String,default:""},imageInputSelector:{type:String,default:"post-images"}},data:()=>({editor:null,session:null,content:"",loading:!0,destroyed:!1}),computed:{listeners(){return{...this.$listeners,change:t=>this.$emit("input",t.target.value)}}},watch:{value:function(t){this.easyMDE&&this.easyMDE.value()!=t&&this.easyMDE.value(t)}},beforeDestroy(){this.destroyed=!0},async mounted(){await this.initializeEditor(),this.loading=!1},methods:{async initializeEditor(){await Object(i.F)(100);const t=this.postId?{enabled:!0,uniqueId:this.postId,delay:5e3}:void 0,e=await Promise.all([s.e(6),s.e(0)]).then(s.t.bind(null,542,7));this.destroyed||(this.easyMDE=new e.default({element:this.$refs.editor,minHeight:"200px",spellChecker:!1,forceSync:!0,autoDownloadFontAwesome:!1,shortcuts:{drawImage:"Shift-Cmd-I"},autosave:t,toolbar:["bold","italic","strikethrough","code","quote","heading","|","unordered-list","ordered-list","|","link","image","table","|","preview","side-by-side","fullscreen","guide"],uploadImage:!0,imageUploadFunction:(t,e,s)=>{Object(o.b)({file:t,onError:t=>{var e;s(null!==(e=t.message)&&void 0!==e?e:"There was an error")},onFinished:t=>{e(t.url),Object(n.a)("addImageToInput",{selector:this.imageInputSelector,_id:t._id})}})}}),Object(n.b)("focus-editor",()=>{this.easyMDE.codemirror.focus()}),Object(n.b)("save-post",()=>{this.easyMDE.clearAutosavedValue()}),this.easyMDE.codemirror.on("change",()=>{this.$emit("input",this.easyMDE.value())}))}}}),l=(s(502),s(414)),d=Object(l.a)(r,(function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"editor-input"},[e("div",{directives:[{name:"show",rawName:"v-show",value:!this.loading,expression:"!loading"}],staticClass:"editor-wrap"},[e("textarea",this._g({ref:"editor",domProps:{value:this.value}},this.listeners))]),this._v(" "),this.loading?e("factor-loading-ring"):this._e()],1)}),[],!1,null,null,null);e.default=d.exports},564:function(t,e,s){"use strict";s.r(e);var a=s(415),i=s(472),n=s(420),o=s.n(n),r=s(1),l=s(464),d=s(2),u=s(7),c=d.a.extend({components:{factorMenu:a.w,factorLoadingRing:a.v,factorIcon:a.d,factorLightbox:a.t},props:{selector:{type:String,default:"none"},loading:{type:Boolean,default:!1},value:{type:[Array,String],default:()=>[]},min:{type:[Number,String],default:0},max:{type:[Number,String],default:10},postId:{type:String,default:"post"}},data:()=>({imageIds:[],uploading:[],lightboxShow:!1,lightboxIndex:0,callback:null,copyText:""}),computed:{post:{get(){return Object(r.A)(this.postId)},set(t){Object(r.z)(this.postId,t)}},single(){return"string"==typeof this.value||1==this.max},maxImages(){return this.single?1:Number(this.max)},isRequired(){return void 0!==this.$attrs.required},populated(){return this.imageIds.map(t=>Object(r.A)(t)).filter(t=>t)},allImages(){return[...this.populated,...this.uploading]}},mounted(){Object(r.o)("uploadImageWithInput",({selector:t,callback:e})=>{t==this.selector&&(this.callback=e,this.triggerUpload())}),Object(r.o)("addImageToInput",({selector:t,_id:e})=>{t==this.selector&&this.imageIds.push(e)}),this.$watch("value",(function(t){t&&(this.imageIds="string"==typeof t?[t]:t)}),{deep:!0,immediate:!0}),this.dom()},methods:{triggerUpload(){this.$refs.multiImageInput.click()},action(t,e){if("view"==e)this.lightboxShow=!0,this.lightboxIndex=this.populated.findIndex(e=>e._id==t);else if("copy-URL"==e)this.copyUrl(t);else if("delete"==e){confirm("Are you sure? This will permanently delete this image.")&&this.removeImage(t)}else"upload-image"==e&&this.triggerUpload()},copyUrl(t){const e=this.populated.find(e=>e._id==t);e&&e.url&&(this.copyText=e.url.includes("base64")?`{{${t}.url}}`:e.url,this.$nextTick(()=>{this.$refs.copyInput.select(),document.execCommand("copy"),Object(r.h)("notify","Url Copied")}))},styleImageBG(t){const{url:e}=t;return e?{backgroundImage:`url(${e})`}:{}},setValidity(){let t="";this.images.length<this.min?t=`Please upload at least ${this.min} images.`:this.images.length>this.maxImages&&(t=`Please submit maximum ${this.maxImages} images.`),this.$emit("update:customValidity",t)},dom(){const t=o()(this.$el),e=t.find(".image-drop");this.imgInput=t.find(".input-upload"),e.on("dragenter",()=>{e.addClass("dragover")}),e.on("dragleave",()=>{e.removeClass("dragover")}),e.on("drop",()=>{e.removeClass("dragover")}),t.on("dragover",t=>{t.stopPropagation(),t.preventDefault()}),t.on("drop",t=>{var s;t.stopPropagation(),t.preventDefault(),e.removeClass("dragover"),(null===(s=t.originalEvent)||void 0===s?void 0:s.dataTransfer)&&this.handleMultiImage(t.originalEvent.dataTransfer.files)}),this.single||l.a.create(this.$refs.organizer,{filter:".ignore-sortable",ghostClass:"sortable-ghost",onUpdate:t=>{if(t.oldIndex&&this.imageIds[t.oldIndex]){const e=this.imageIds.splice(t.oldIndex,1);this.imageIds.splice(t.newIndex,0,e[0]),this.updateValue()}},onMove:t=>!o()(t.related).hasClass("ignore-sortable")})},updateValue(){var t;const e=this.imageIds.filter(t=>this.populated.find(e=>e._id==t));let s;s=this.single?null!==(t=e[0])&&void 0!==t?t:null:e,this.$emit("input",s),this.$emit("update:customValidity",this.validity)},async removeImage(t){this.removeFromArrayById(t,this.imageIds),this.post&&this.post.images&&this.removeFromArrayById(t,this.post.images),await Object(i.a)({_id:t})},handleMultiUpload(t){this.handleMultiImage(t.target.files)},async handleMultiImage(t){let e;this.numFiles=0,t[0]&&1==this.maxImages&&this.imageIds.length>=1&&(e=this.imageIds[0],this.removeFromArrayById(e,this.imageIds));for(const s of t)if(this.imageIds.length<this.maxImages){const t={status:"preprocess",_id:Object(u.c)()};this.uploading.push(t),this.numFiles++,this.uploadFile({item:t,file:s,onError:()=>{},onFinished:()=>{e&&this.removeImage(e)}})}},uploadFile({file:t,onFinished:e,item:s}){this.$emit("upload",{file:t,item:s}),Object(i.b)({file:t,onPrep:({preview:t=""})=>{t&&this.up(s._id,"url",t),this.up(s._id,"status","preprocess")},onChange:t=>{const{loaded:e,total:a}=t;this.up(s._id,"status","progress"),this.up(s._id,"progress",e/a*100),e/a>=1&&this.up(s._id,"status","processing")},onError:t=>{this.up(s._id,"status","error"),this.up(s._id,"message",t.message)},onFinished:t=>{const{_id:a}=t;this.pushNewImage(a),this.removeFromArrayById(s._id,this.uploading),e&&e()}})},pushNewImage(t){this.imageIds.push(t),this.post&&this.post.images&&this.$set(this.post,"images",[...this.post.images,t])},up(t,e,s){const a=this.uploading.findIndex(e=>e._id==t);-1!=a&&this.$set(this.uploading[a],e,s)},removeFromArrayById(t,e){const s=e.findIndex(e=>"string"==typeof e?e==t:e._id==t);if(-1!=s){const t=e[s];return this.$delete(e,s),this.updateValue(),t}}}}),p=(s(507),s(414)),h=Object(p.a)(c,(function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"image-upload-container"},[s("div",{staticClass:"image-upload-input"},[s("div",{ref:"organizer",staticClass:"image-organizer"},[t._l(t.allImages,(function(e){return s("div",{key:e._id,staticClass:"image-item image-uploaded",class:t.single?"no-sort-img":"sort-img"},[s("div",{staticClass:"image-item-pad"},[s("div",{staticClass:"image-item-content",class:e.status||"no-status",style:t.styleImageBG(e)},[s("div",{staticClass:"status-bar"},[["progress","preprocess","processing"].includes(e.status)?s("div",{staticClass:"image-status overlay",class:e.status},[s("div",{staticClass:"bar",style:{width:e.progress+"%"}})]):s("factor-menu",{staticClass:"menu",attrs:{list:["upload-image","view","copy-URL","delete"],"drop-direction":"up"},on:{action:function(s){return t.action(e._id,s)}}})],1)])])])})),t._v(" "),t.single||t.imageIds.length<t.maxImages?s("div",{ref:"multiImageDrop",staticClass:"image-item ignore-sortable image-drop",class:t.single&&(t.populated.length>0||t.uploading.length>0)?"single-image-drop":""},[s("div",{staticClass:"image-item-pad"},[s("div",{staticClass:"image-item-content"},[s("input",{ref:"multiImageInput",staticClass:"input-upload",attrs:{type:"file",accept:"image/*",multiple:""},on:{change:function(e){return t.handleMultiUpload(e)}}}),t._v(" "),t.loading?s("factor-loading-ring",{attrs:{width:"2em"}}):s("div",{staticClass:"upload-status"},[s("factor-icon",{attrs:{icon:"fas fa-plus"}})],1)],1)])]):t._e()],2)]),t._v(" "),s("input",{directives:[{name:"model",rawName:"v-model",value:t.copyText,expression:"copyText"}],ref:"copyInput",staticClass:"invisible-copy",attrs:{type:"text"},domProps:{value:t.copyText},on:{input:function(e){e.target.composing||(t.copyText=e.target.value)}}}),t._v(" "),s("factor-lightbox",{attrs:{visible:t.lightboxShow,imgs:t.populated,index:t.lightboxIndex},on:{"update:visible":function(e){t.lightboxShow=e}}})],1)}),[],!1,null,null,null);e.default=h.exports}}]);